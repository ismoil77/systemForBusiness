<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>üìä –û—Ç—á—ë—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏</title>
		<style>
			/* === –°–ë–†–û–° –ò –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò === */
			* {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			}

			:root {
				--primary: #4361ee;
				--primary-dark: #3a56d4;
				--success: #06d6a0;
				--danger: #ef476f;
				--warning: #ffd166;
				--light: #f8f9fa;
				--dark: #212529;
				--gray: #6c757d;
				--border: #dee2e6;
				--shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
				--radius: 12px;
				--transition: all 0.3s ease;
			}

			body {
				font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
				background: linear-gradient(135deg, #f5f7fa 0%, #e4edf9 100%);
				color: var(--dark);
				line-height: 1.6;
				padding: 20px;
				min-height: 100vh;
			}

			.container {
				max-width: 1400px;
				margin: 0 auto;
			}

			/* === –ó–ê–ì–û–õ–û–í–û–ö === */
			.header {
				background: white;
				padding: 30px;
				border-radius: var(--radius);
				box-shadow: var(--shadow);
				margin-bottom: 24px;
				text-align: center;
			}

			.header h1 {
				color: var(--primary);
				font-size: 2.5rem;
				margin-bottom: 10px;
			}

			.header p {
				color: var(--gray);
				font-size: 1.1rem;
			}

			/* === –ü–ê–ù–ï–õ–¨ –§–ò–õ–¨–¢–†–û–í === */
			.filters {
				background: white;
				padding: 25px;
				border-radius: var(--radius);
				box-shadow: var(--shadow);
				margin-bottom: 24px;
			}

			.filters h2 {
				color: var(--dark);
				margin-bottom: 20px;
				font-size: 1.5rem;
			}

			.filter-row {
				display: flex;
				flex-wrap: wrap;
				gap: 15px;
				align-items: flex-end;
			}

			.filter-group {
				flex: 1;
				min-width: 200px;
			}

			.filter-group label {
				display: block;
				margin-bottom: 8px;
				font-weight: 600;
				color: var(--dark);
			}

			.filter-group select,
			.filter-group input {
				width: 100%;
				padding: 12px 16px;
				border: 2px solid var(--border);
				border-radius: var(--radius);
				font-size: 1rem;
				transition: var(--transition);
			}

			.filter-group select:focus,
			.filter-group input:focus {
				border-color: var(--primary);
				outline: none;
				box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
			}

			/* === –ö–ù–û–ü–ö–ò === */
			.btn {
				padding: 12px 24px;
				border: none;
				border-radius: var(--radius);
				font-weight: 600;
				font-size: 1rem;
				cursor: pointer;
				transition: var(--transition);
				display: inline-flex;
				align-items: center;
				justify-content: center;
				gap: 8px;
				min-width: 200px;
			}

			.btn:hover {
				opacity: 0.9;
				transform: translateY(-2px);
				box-shadow: var(--shadow);
			}

			.btn:active {
				transform: translateY(0);
			}

			.btn-primary {
				background: linear-gradient(
					135deg,
					var(--primary) 0%,
					var(--primary-dark) 100%
				);
				color: white;
			}

			.btn-success {
				background: var(--success);
				color: white;
			}

			.btn-secondary {
				background: var(--gray);
				color: white;
			}

			/* === –ö–û–ù–¢–ï–ù–¢ –û–¢–ß–Å–¢–û–í === */
			.report-content {
				background: white;
				padding: 30px;
				border-radius: var(--radius);
				box-shadow: var(--shadow);
				min-height: 400px;
			}

			.report-content h2 {
				color: var(--primary);
				margin-bottom: 20px;
				font-size: 2rem;
			}

			.report-content h3 {
				color: var(--dark);
				margin-top: 25px;
				margin-bottom: 15px;
			}

			.report-content p {
				margin-bottom: 15px;
				font-size: 1.1rem;
			}

			/* === –¢–ê–ë–õ–ò–¶–´ –û–¢–ß–Å–¢–û–í === */
			.report-table {
				width: 100%;
				border-collapse: collapse;
				margin: 20px 0;
				box-shadow: var(--shadow);
				border-radius: var(--radius);
				overflow: hidden;
			}

			.report-table thead {
				background: linear-gradient(
					135deg,
					var(--primary) 0%,
					var(--primary-dark) 100%
				);
				color: white;
			}

			.report-table th {
				padding: 15px;
				text-align: left;
				font-weight: 600;
				font-size: 1rem;
			}

			.report-table td {
				padding: 12px 15px;
				border-bottom: 1px solid var(--border);
			}

			.report-table tbody tr:hover {
				background: var(--light);
				transition: var(--transition);
			}

			.report-table tfoot {
				background: var(--light);
				font-weight: 700;
			}

			.report-table tfoot td {
				padding: 15px;
				border-top: 2px solid var(--primary);
			}

			/* === SUMMARY –ë–õ–û–ö === */
			.report-summary {
				background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
				padding: 25px;
				border-radius: var(--radius);
				margin: 25px 0;
				border-left: 5px solid var(--primary);
			}

			.report-summary h3 {
				margin-top: 0;
				color: var(--primary);
			}

			.report-summary p {
				margin: 10px 0;
				font-size: 1.1rem;
			}

			/* === –ó–ê–ì–†–£–ó–ö–ê === */
			.loading {
				display: none;
				text-align: center;
				padding: 40px;
				color: var(--gray);
			}

			.loading.active {
				display: block;
			}

			.spinner {
				border: 4px solid var(--border);
				border-top: 4px solid var(--primary);
				border-radius: 50%;
				width: 50px;
				height: 50px;
				animation: spin 1s linear infinite;
				margin: 0 auto 15px;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}

			/* === –ü–£–°–¢–û–ô –°–¢–ï–ô–¢ === */
			.empty-state {
				text-align: center;
				padding: 60px 20px;
				color: var(--gray);
			}

			.empty-state h3 {
				font-size: 1.5rem;
				margin-bottom: 10px;
			}

			/* === –ü–ï–ß–ê–¢–¨ === */
			@media print {
				body {
					background: white;
					padding: 0;
				}

				.filters,
				.btn {
					display: none !important;
				}

				.report-content {
					box-shadow: none;
				}
			}

			/* === –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ === */
			@media (max-width: 768px) {
				.filter-row {
					flex-direction: column;
				}

				.filter-group {
					width: 100%;
				}

				.btn {
					width: 100%;
				}

				.header h1 {
					font-size: 1.8rem;
				}

				.report-table {
					font-size: 0.9rem;
				}

				.report-table th,
				.report-table td {
					padding: 8px;
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<!-- –ó–ê–ì–û–õ–û–í–û–ö -->
			<div class="header">
				<h1>üìä –û—Ç—á—ë—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>
				<p>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –ø—Ä–æ–¥–∞–∂–∞–º–∏</p>
			</div>

			<!-- –ü–ê–ù–ï–õ–¨ –§–ò–õ–¨–¢–†–û–í -->
			<div class="filters">
				<h2>üîç –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç—á—ë—Ç–∞</h2>
				<div class="filter-row">
					<div class="filter-group">
						<label for="reportType">–¢–∏–ø –æ—Ç—á—ë—Ç–∞:</label>
						<select id="reportType">
							<option value="sales-by-employee">
								üíº –ü—Ä–æ–¥–∞–∂–∏ –ø–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞–º
							</option>
							<option value="active-clients">üë• –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã</option>
							<option value="debt-analysis">üí∞ –ê–Ω–∞–ª–∏–∑ –¥–æ–ª–≥–æ–≤</option>
							<option value="top-clients">üèÜ –¢–æ–ø –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –ø–æ–∫—É–ø–∫–∞–º</option>
						</select>
					</div>

					<div class="filter-group">
						<label for="startDate">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</label>
						<input type="date" id="startDate" />
					</div>

					<div class="filter-group">
						<label for="endDate">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
						<input type="date" id="endDate" />
					</div>

					<div class="filter-group">
						<button class="btn btn-primary" id="generateBtn">
							üìà –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç
						</button>
					</div>
				</div>
			</div>

			<!-- –ó–ê–ì–†–£–ó–ö–ê -->
			<div class="loading" id="loading">
				<div class="spinner"></div>
				<p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
			</div>

			<!-- –ö–û–ù–¢–ï–ù–¢ –û–¢–ß–Å–¢–û–í -->
			<div class="report-content" id="reportContent">
				<div class="empty-state">
					<h3>üìã –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ç—á—ë—Ç–∞</h3>
					<p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã—à–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç"</p>
				</div>
			</div>
		</div>

		<script>
			// === –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===
			const reportTypeSelect = document.getElementById('reportType')
			const startDateInput = document.getElementById('startDate')
			const endDateInput = document.getElementById('endDate')
			const generateBtn = document.getElementById('generateBtn')
			const reportContent = document.getElementById('reportContent')
			const loading = document.getElementById('loading')

			// === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –î–ê–¢ ===
			function initDates() {
				const today = new Date().toISOString().split('T')[0]
				const monthAgo = new Date()
				monthAgo.setDate(monthAgo.getDate() - 30)
				const monthAgoStr = monthAgo.toISOString().split('T')[0]

				startDateInput.value = monthAgoStr
				endDateInput.value = today
			}

			// === –ü–û–ö–ê–ó–ê–¢–¨/–°–ö–†–´–¢–¨ –ó–ê–ì–†–£–ó–ö–£ ===
			function showLoading() {
				loading.classList.add('active')
				reportContent.style.display = 'none'
			}

			function hideLoading() {
				loading.classList.remove('active')
				reportContent.style.display = 'block'
			}

			// === –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –î–ê–¢–´ ===
			function formatDate(dateStr) {
				const date = new Date(dateStr)
				return date.toLocaleDateString('ru-RU')
			}

			// === –û–ë–†–ê–ë–û–¢–ß–ò–ö –ì–ï–ù–ï–†–ê–¶–ò–ò –û–¢–ß–Å–¢–ê ===
			generateBtn.addEventListener('click', async () => {
				const reportType = reportTypeSelect.value
				const startDate = startDateInput.value
				const endDate = endDateInput.value

				if (!reportType || !startDate || !endDate) {
					alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è')
					return
				}

				showLoading()

				try {
					switch (reportType) {
						case 'sales-by-employee':
							await generateSalesByEmployeeReport(startDate, endDate)
							break
						case 'active-clients':
							await generateActiveClientsReport(startDate, endDate)
							break
						case 'debt-analysis':
							await generateDebtAnalysisReport()
							break
						case 'top-clients':
							await generateTopClientsReport(startDate, endDate)
							break
						default:
							alert('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –æ—Ç—á—ë—Ç–∞')
					}
				} catch (err) {
					console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–∞:', err)
					reportContent.innerHTML =
						'<p style="color: red;">‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.</p>'
				} finally {
					hideLoading()
				}
			})

			// === –û–¢–ß–Å–¢: –ü–†–û–î–ê–ñ–ò –ü–û –†–ê–ë–û–¢–ù–ò–ö–ê–ú ===
			async function generateSalesByEmployeeReport(startDate, endDate) {
				try {
					// –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ API
					const [dilobarRes, murodulloRes, dilangezRes] = await Promise.all([
						fetch('https://7cf074eeac80e141.mokky.dev/DilobarQurbanova'),
						fetch('https://7cf074eeac80e141.mokky.dev/MamatkulovMurodullo'),
						fetch('https://7cf074eeac80e141.mokky.dev/DilangezZhabborova'),
					])

					const dilobarClients = await dilobarRes.json()
					const murodulloClients = await murodulloRes.json()
					const dilangezClients = await dilangezRes.json()

					const employeeStats = {
						Dilobar: { sales: 0, debts: 0, payments: 0 },
						Murodullo: { sales: 0, debts: 0, payments: 0 },
						Dilangez: { sales: 0, debts: 0, payments: 0 },
					}

					// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–ª–∏–µ–Ω—Ç–æ–≤ Dilobar
					dilobarClients.forEach(client => {
						// –ü—Ä–æ–¥–∞–∂–∏ (–¥–æ–ª–≥–∏) –∑–∞ –ø–µ—Ä–∏–æ–¥
						;
						const creditHistory = Array.isArray(client.creditHistory)
  ? client.creditHistory
  : []

creditHistory.forEach(entry => {
								const date = entry[0]
								if (date >= startDate && date <= endDate) {
									const amount =
										parseFloat(entry[1].replace(/[^0-9.-]/g, '')) || 0
									employeeStats.Dilobar.debts += amount
									employeeStats.Dilobar.sales += amount
								}
							})
						const viruchka = Array.isArray(client.viruchka)
  ? client.viruchka
  : []

viruchka.forEach(entry => {

								const date = entry[0]
								if (date >= startDate && date <= endDate) {
									const amount =
										parseFloat(entry[1].replace(/[^0-9.-]/g, '')) || 0
									employeeStats.Dilobar.payments += amount
								}
							})
					})

					// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–ª–∏–µ–Ω—Ç–æ–≤ Murodullo
					murodulloClients.forEach(client => {
						// –ü—Ä–æ–¥–∞–∂–∏ (–¥–æ–ª–≥–∏) –∑–∞ –ø–µ—Ä–∏–æ–¥
						;const creditHistory = Array.isArray(client.creditHistory)
  ? client.creditHistory
  : []

creditHistory.forEach(entry => {

								const date = entry[0]
								if (date >= startDate && date <= endDate) {
									const amount =
										parseFloat(entry[1].replace(/[^0-9.-]/g, '')) || 0
									employeeStats.Murodullo.debts += amount
									employeeStats.Murodullo.sales += amount
								}
							})
							const viruchka = Array.isArray(client.viruchka)
  ? client.viruchka
  : []

viruchka.forEach(entry => {

								const date = entry[0]
								if (date >= startDate && date <= endDate) {
									const amount =
										parseFloat(entry[1].replace(/[^0-9.-]/g, '')) || 0
									employeeStats.Murodullo.payments += amount
								}
							})
					})

					// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–ª–∏–µ–Ω—Ç–æ–≤ Dilangez
					dilangezClients.forEach(client => {
						// –ü—Ä–æ–¥–∞–∂–∏ (–¥–æ–ª–≥–∏) –∑–∞ –ø–µ—Ä–∏–æ–¥
						;(client.creditHistory || [])
							.forEach(entry => {
								const date = entry[0]
								if (date >= startDate && date <= endDate) {
									const amount =
										parseFloat(entry[1].replace(/[^0-9.-]/g, '')) || 0
									employeeStats.Dilangez.debts += amount
									employeeStats.Dilangez.sales += amount
								}
							})
						const viruchka = Array.isArray(client.viruchka)
  ? client.viruchka
  : []

viruchka.forEach(entry => {

								const date = entry[0]
								if (date >= startDate && date <= endDate) {
									const amount =
										parseFloat(entry[1].replace(/[^0-9.-]/g, '')) || 0
									employeeStats.Dilangez.payments += amount
								}
							})
					})

					let html = `
					<h2>üìä –ü—Ä–æ–¥–∞–∂–∏ –ø–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞–º</h2>
					<p>–ü–µ—Ä–∏–æ–¥: ${formatDate(startDate)} - ${formatDate(endDate)}</p>
					<table class="report-table">
						<thead>
							<tr>
								<th>–†–∞–±–æ—Ç–Ω–∏–∫</th>
								<th>–ü—Ä–æ–¥–∞–∂–∏ (–¥–æ–ª–≥–∏)</th>
								<th>–í—ã–ø–ª–∞—Ç—ã —Å–æ–±—Ä–∞–Ω–æ</th>
								<th>–ò—Ç–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
							</tr>
						</thead>
						<tbody>
				`

					Object.keys(employeeStats).forEach(employee => {
						const stats = employeeStats[employee]
						const total = stats.sales + stats.payments

						html += `
						<tr>
							<td><strong>${employee}</strong></td>
							<td>${stats.debts.toFixed(0)} —Å–æ–º.</td>
							<td>${stats.payments.toFixed(0)} —Å–æ–º.</td>
							<td><strong>${total.toFixed(0)} —Å–æ–º.</strong></td>
						</tr>
					`
					})

					const totalSales =
						employeeStats.Dilobar.sales +
						employeeStats.Murodullo.sales +
						employeeStats.Dilangez.sales
					const totalPayments =
						employeeStats.Dilobar.payments +
						employeeStats.Murodullo.payments +
						employeeStats.Dilangez.payments

					html += `
						</tbody>
						<tfoot>
							<tr>
								<td><strong>–ò–¢–û–ì–û:</strong></td>
								<td><strong>${totalSales.toFixed(0)} —Å–æ–º.</strong></td>
								<td><strong>${totalPayments.toFixed(0)} —Å–æ–º.</strong></td>
								<td><strong>${(totalSales + totalPayments).toFixed(0)} —Å–æ–º.</strong></td>
							</tr>
						</tfoot>
					</table>

					<div class="report-summary">
						<h3>–ö—Ç–æ –±–æ–ª—å—à–µ —Ä–∞–±–æ—Ç–∞–ª:</h3>
						<p>${(() => {
							const scores = {
								Dilobar:
									employeeStats.Dilobar.sales + employeeStats.Dilobar.payments,
								Murodullo:
									employeeStats.Murodullo.sales +
									employeeStats.Murodullo.payments,
								Dilangez:
									employeeStats.Dilangez.sales +
									employeeStats.Dilangez.payments,
							}
							const leader = Object.keys(scores).reduce((a, b) =>
								scores[a] > scores[b] ? a : b
							)
							return 'üèÜ ' + leader + ' –ª–∏–¥–∏—Ä—É–µ—Ç!'
						})()}</p>
					</div>

					<button class="btn btn-success" onclick="window.print()">üñ® –ü–µ—á–∞—Ç—å –æ—Ç—á—ë—Ç–∞</button>
				`

					reportContent.innerHTML = html
				} catch (err) {
					console.error(err)
					reportContent.innerHTML =
						'<p style="color: red;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—á—ë—Ç–∞</p>'
				}
			}

			// === –û–¢–ß–Å–¢: –ê–ö–¢–ò–í–ù–´–ï –ö–õ–ò–ï–ù–¢–´ ===
			async function generateActiveClientsReport(startDate, endDate) {
				try {
					const [dilobarRes, murodulloRes, dilangezRes] = await Promise.all([
						fetch('https://7cf074eeac80e141.mokky.dev/DilobarQurbanova'),
						fetch('https://7cf074eeac80e141.mokky.dev/MamatkulovMurodullo'),
						fetch('https://7cf074eeac80e141.mokky.dev/DilangezZhabborova'),
					])

					const dilobarClients = await dilobarRes.json()
					const murodulloClients = await murodulloRes.json()
					const dilangezClients = await dilangezRes.json()
					const allClients = [
						...dilobarClients.map(c => ({ ...c, owner: 'Dilobar' })),
						...murodulloClients.map(c => ({ ...c, owner: 'Murodullo' })),
						...dilangezClients.map(c => ({ ...c, owner: 'Dilangez' })),
					]

					const activeClients = allClients.filter(client => {
						const hasActivity =
							client.creditHistory?.some(h => {
								const date = h[0]
								return date >= startDate && date <= endDate
							}) ||
							client.viruchka?.some(v => {
								const date = v[0]
								return date >= startDate && date <= endDate
							})

						return hasActivity
					})

					activeClients.sort((a, b) => b.credit - a.credit)

					let html = `
					<h2>üë• –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã</h2>
					<p>–ü–µ—Ä–∏–æ–¥: ${formatDate(startDate)} - ${formatDate(endDate)}</p>
					<p>–ù–∞–π–¥–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤: <strong>${activeClients.length}</strong></p>

					<table class="report-table">
						<thead>
							<tr>
								<th>‚Ññ</th>
								<th>–ö–ª–∏–µ–Ω—Ç</th>
								<th>–ú–µ—Å—Ç–æ</th>
								<th>–î–æ–ª–≥</th>
								<th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
								<th>–ú–µ–Ω–µ–¥–∂–µ—Ä</th>
							</tr>
						</thead>
						<tbody>
				`

					activeClients.forEach((client, index) => {
						html += `
						<tr>
							<td>${index + 1}</td>
							<td><strong>${client.client}</strong></td>
							<td>${client.place || '-'}</td>
							<td>${(client.credit || 0).toFixed(0)} —Å–æ–º.</td>
							<td>${client.phoneNumber?.[0] || '-'}</td>
							<td>${client.owner}</td>
						</tr>
					`
					})

					const totalDebt = activeClients.reduce(
						(sum, c) => sum + (c.credit || 0),
						0
					)

					html += `
						</tbody>
						<tfoot>
							<tr>
								<td colspan="3"><strong>–ò–¢–û–ì–û –¥–æ–ª–≥:</strong></td>
								<td colspan="3"><strong>${totalDebt.toFixed(0)} —Å–æ–º.</strong></td>
							</tr>
						</tfoot>
					</table>

					<button class="btn btn-success" onclick="window.print()">üñ® –ü–µ—á–∞—Ç—å –æ—Ç—á—ë—Ç–∞</button>
				`

					reportContent.innerHTML = html
				} catch (err) {
					console.error(err)
					reportContent.innerHTML =
						'<p style="color: red;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</p>'
				}
			}

			// === –û–¢–ß–Å–¢: –ê–ù–ê–õ–ò–ó –î–û–õ–ì–û–í ===
			async function generateDebtAnalysisReport() {
				try {
					const [dilobarRes, murodulloRes, dilangezRes] = await Promise.all([
						fetch('https://7cf074eeac80e141.mokky.dev/DilobarQurbanova'),
						fetch('https://7cf074eeac80e141.mokky.dev/MamatkulovMurodullo'),
						fetch('https://7cf074eeac80e141.mokky.dev/DilangezZhabborova'),
					])

					const dilobarClients = await dilobarRes.json()
					const murodulloClients = await murodulloRes.json()
					const dilangezClients = await dilangezRes.json()
					const allClients = [
						...dilobarClients.map(c => ({ ...c, owner: 'Dilobar' })),
						...murodulloClients.map(c => ({ ...c, owner: 'Murodullo' })),
						...dilangezClients.map(c => ({ ...c, owner: 'Dilangez' })),
					]

					const debtors = allClients.filter(c => c.credit > 0)
					debtors.sort((a, b) => b.credit - a.credit)

					const top10 = debtors.slice(0, 10)

					let html = `
					<h2>üí∞ –ê–Ω–∞–ª–∏–∑ –¥–æ–ª–≥–æ–≤</h2>
					<p>–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –¥–æ–ª–≥–æ–º: <strong>${debtors.length}</strong></p>

					<h3>–¢–û–ü-10 –¥–æ–ª–∂–Ω–∏–∫–æ–≤:</h3>
					<table class="report-table">
						<thead>
							<tr>
								<th>‚Ññ</th>
								<th>–ö–ª–∏–µ–Ω—Ç</th>
								<th>–ú–µ—Å—Ç–æ</th>
								<th>–î–æ–ª–≥</th>
								<th>–ú–µ–Ω–µ–¥–∂–µ—Ä</th>
							</tr>
						</thead>
						<tbody>
				`

					top10.forEach((client, index) => {
						html += `
						<tr>
							<td>${index + 1}</td>
							<td><strong>${client.client}</strong></td>
							<td>${client.place || '-'}</td>
							<td style="color: #ef476f;"><strong>${client.credit.toFixed(
								0
							)} —Å–æ–º.</strong></td>
							<td>${client.owner}</td>
						</tr>
					`
					})

					const totalDebt = debtors.reduce((sum, c) => sum + c.credit, 0)
					const avgDebt = totalDebt / debtors.length

					html += `
						</tbody>
					</table>

					<div class="report-summary">
						<h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h3>
						<p>üìä –û–±—â–∏–π –¥–æ–ª–≥: <strong>${totalDebt.toFixed(0)} —Å–æ–º–æ–Ω–∏</strong></p>
						<p>üìà –°—Ä–µ–¥–Ω–∏–π –¥–æ–ª–≥: <strong>${avgDebt.toFixed(0)} —Å–æ–º–æ–Ω–∏</strong></p>
						<p>üîù –°–∞–º—ã–π –±–æ–ª—å—à–æ–π –¥–æ–ª–≥: <strong>${
							top10[0]?.credit.toFixed(0) || 0
						} —Å–æ–º–æ–Ω–∏</strong> (${top10[0]?.client || '-'})</p>
					</div>

					<button class="btn btn-success" onclick="window.print()">üñ® –ü–µ—á–∞—Ç—å –æ—Ç—á—ë—Ç–∞</button>
				`

					reportContent.innerHTML = html
				} catch (err) {
					console.error(err)
					reportContent.innerHTML =
						'<p style="color: red;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>'
				}
			}

			// === –û–¢–ß–Å–¢: –¢–û–ü –ö–õ–ò–ï–ù–¢–û–í ===
			async function generateTopClientsReport(startDate, endDate) {
				try {
					const [dilobarRes, murodulloRes, dilangezRes] = await Promise.all([
						fetch('https://7cf074eeac80e141.mokky.dev/DilobarQurbanova'),
						fetch('https://7cf074eeac80e141.mokky.dev/MamatkulovMurodullo'),
						fetch('https://7cf074eeac80e141.mokky.dev/DilangezZhabborova'),
					])

					const dilobarClients = await dilobarRes.json()
					const murodulloClients = await murodulloRes.json()
					const dilangezClients = await dilangezRes.json()
					const allClients = [
						...dilobarClients.map(c => ({ ...c, owner: 'Dilobar' })),
						...murodulloClients.map(c => ({ ...c, owner: 'Murodullo' })),
						...dilangezClients.map(c => ({ ...c, owner: 'Dilangez' })),
					]

					const clientsWithPurchases = allClients.map(client => {
						const purchases = (client.creditHistory || [])
							.filter(h => h[0] >= startDate && h[0] <= endDate)
							.reduce((sum, h) => {
								const amount = parseFloat(h[1].replace(/[^0-9.-]/g, '')) || 0
								return sum + amount
							}, 0)

						return { ...client, purchases }
					})

					const topClients = clientsWithPurchases
						.filter(c => c.purchases > 0)
						.sort((a, b) => b.purchases - a.purchases)
						.slice(0, 20)

					let html = `
					<h2>üèÜ –¢–æ–ø –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –ø–æ–∫—É–ø–∫–∞–º</h2>
					<p>–ü–µ—Ä–∏–æ–¥: ${formatDate(startDate)} - ${formatDate(endDate)}</p>

					<table class="report-table">
						<thead>
							<tr>
								<th>‚Ññ</th>
								<th>–ö–ª–∏–µ–Ω—Ç</th>
								<th>–ú–µ—Å—Ç–æ</th>
								<th>–°—É–º–º–∞ –ø–æ–∫—É–ø–æ–∫</th>
								<th>–¢–µ–∫—É—â–∏–π –¥–æ–ª–≥</th>
								<th>–ú–µ–Ω–µ–¥–∂–µ—Ä</th>
							</tr>
						</thead>
						<tbody>
				`

					topClients.forEach((client, index) => {
						html += `
						<tr>
							<td>${index + 1}</td>
							<td><strong>${client.client}</strong></td>
							<td>${client.place || '-'}</td>
							<td style="color: #06d6a0;"><strong>${client.purchases.toFixed(
								0
							)} —Å–æ–º.</strong></td>
							<td>${(client.credit || 0).toFixed(0)} —Å–æ–º.</td>
							<td>${client.owner}</td>
						</tr>
					`
					})

					const totalPurchases = topClients.reduce(
						(sum, c) => sum + c.purchases,
						0
					)

					html += `
						</tbody>
						<tfoot>
							<tr>
								<td colspan="3"><strong>–ò–¢–û–ì–û –ø–æ–∫—É–ø–æ–∫:</strong></td>
								<td colspan="3"><strong>${totalPurchases.toFixed(0)} —Å–æ–º.</strong></td>
							</tr>
						</tfoot>
					</table>

					<button class="btn btn-success" onclick="window.print()">üñ® –ü–µ—á–∞—Ç—å –æ—Ç—á—ë—Ç–∞</button>
				`

					reportContent.innerHTML = html
				} catch (err) {
					console.error(err)
					reportContent.innerHTML =
						'<p style="color: red;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>'
				}
			}

			// === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
			initDates()
		</script>
	</body>
</html>
